Функция КПВ_СоздатьФайлXLSИзТабличногоДокумента(ТабличныйДокумент) Экспорт  // сохраняет табличный документ в файл .xls и возвращает путь к файлу
	Путь = КаталогВременныхФайлов()+ "\ati_" + Формат(ТекущаяДата(), "ДФ=yyyyMMdd") + ".xls";
	ТабличныйДокумент.Записать(Путь,ТипФайлаТабличногоДокумента.XLS);
	Возврат Путь
КонецФункции

Функция КПВ_ОтправитьЭлектроннуюПочту(Адресаты, ТемаСообщения, ТекстСообщения = "Письмо отправлено автоматически", ПриложенныеФайлы) Экспорт  // отправляет email с сервера.
	// параметры - массив адресатов или строка через точку с запятой, тема, текст, массив приложенных файлов или строка через точку с запятой
	// результат - пустая строка или возможные ошибки
	Результат = "";
	
	Если  ТипЗнч(Адресаты) = Тип("Строка") Тогда   
		Адресаты = РазложитьСтрокуВМассивПодстрок(Адресаты, ";");
	КонецЕсли;
	Если  ТипЗнч(ПриложенныеФайлы) = Тип("Строка") Тогда
		ПриложенныеФайлы = РазложитьСтрокуВМассивПодстрок(ПриложенныеФайлы, ";");
	КонецЕсли;
	
	Профиль = новый ИнтернетПочтовыйПрофиль;
	Профиль.АдресСервераSMTP = "xxx.xx.xx.x";
	Профиль.ПортSMTP = 25;
	Профиль.ПользовательSMTP = "xxx@xx.xx";
	Профиль.ПарольSMTP = "xxxxxx"; // 
	ПРофиль.АутентификацияSMTP = СпособSMTPАутентификации.Login;
	
	Сообщение = Новый ИнтернетПочтовоеСообщение;
	Сообщение.Отправитель = "xxx@xx.xx";
	Сообщение.Тема = ТемаСообщения;
	
	Для Каждого Адресат из Адресаты Цикл
		Сообщение.Получатели.Добавить(Адресат);
	КонецЦикла;
	Для Каждого Файл из ПриложенныеФайлы Цикл
		Сообщение.Вложения.Добавить(Файл);
	КонецЦикла;
	
	Сообщение.Тексты.Добавить(ТекстСообщения);
	
	Почта = Новый ИнтернетПочта;
	Попытка 
		Почта.Подключиться(Профиль);
		Почта.Послать(Сообщение);
	Исключение
		Сообщить("Ошибка соединения с сервером.",СтатусСообщения.ОченьВажное);
		Сообщить(""+ОписаниеОшибки());
		Результат = ОписаниеОшибки();
	КонецПопытки;
	
	Возврат Результат	
КонецФункции
